apiVersion: v1
kind: ConfigMap
metadata:
  name: api-gateway-config
  namespace: minimarket
data:
  application.yml: |
    server:
      port: 8080

    spring:
      application:
        name: api-gateway

      cloud:
        gateway:
          discovery:
            locator:
              enabled: false
          routes:
            # ---- PRODUCT SERVICE ----
            - id: product-service
              uri: http://product-service.minimarket.svc.cluster.local:8081
              predicates:
                - Path=/api/v1/products/**
              # Filters removed to preserve path

            # ---- CATEGORY SERVICE ----
            - id: category-service
              uri: http://category-service.minimarket.svc.cluster.local:8082
              predicates:
                - Path=/api/v1/categories/**
              # Filters removed to preserve path

            # ---- PROVIDER SERVICE ----
            - id: provider-service
              uri: http://provider-service.minimarket.svc.cluster.local:8083
              predicates:
                - Path=/api/v1/providers/**
              # Filters removed to preserve path

            # ---- STOCK SERVICE ----
            - id: stock-service
              uri: http://stock-service.minimarket.svc.cluster.local:8084
              predicates:
                - Path=/api/v1/stock/**
              # Filters removed to preserve path

      # Keycloak Configuration
      security:
        oauth2:
          resourceserver:
            jwt:
              jwk-set-uri: http://keycloak.minimarket.svc.cluster.local:8080/realms/minimarket/protocol/openid-connect/certs

    management:
      endpoints:
        web:
          exposure:
            include: health,info,metrics
